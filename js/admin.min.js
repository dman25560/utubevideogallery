var utvAdmin={};utvAdmin.initialize=function(t){utvAdmin.setupObjects(t),utvAdmin.setupFunctions(t),utvAdmin.setupEvents(t)},utvAdmin.setupEvents=function(t){t(function(){if(t("#utv-vid-data").length){var e=t("#utv-vid-data").val().split(":");2==e.length&&(utvAdmin.videomemory.vid=e[0],utvAdmin.videomemory.source=e[1])}t("#utv-videoadd-submit, #saveAlbum, #createGallery, #saveAlbumEdit, #saveGalleryEdit, #saveVideoEdit").click(function(){var e=t(this).parents("form");if(utvAdmin.checkForm(e))return!1}),t("#utv-videoadd-url").change(function(){var e=t("#utv-videoadd-source").val(),i=t(this).val();if(utvAdmin.videomemory.autoplay=0,""!=i){if("youtube"==e)utvAdmin.videomemory.source="youtube",null!=(a=i.match(/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s&]+)/))&&(utvAdmin.videomemory.vid=a[1]);else if("vimeo"==e){utvAdmin.videomemory.source="vimeo";var a=i.match(/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/);null!=a&&(utvAdmin.videomemory.vid=a[2])}}else utvAdmin.videomemory.source="",utvAdmin.videomemory.vid="";t("#utv-video-preview").attr("src",utvAdmin.generateEmbedUrl())}),t("#utv-videoadd-starttime").change(function(){var e=t(this).val();isNaN(e)?(utvAdmin.videomemory.starttime="",t(this).val("")):(utvAdmin.videomemory.starttime=e,utvAdmin.videomemory.autoplay=1),t("#utv-video-preview").attr("src",utvAdmin.generateEmbedUrl())}),t("#utv-videoadd-endtime").change(function(){var e=t(this).val();isNaN(e)?(utvAdmin.videomemory.endtime="",t(this).val("")):(utvAdmin.videomemory.endtime=e,utvAdmin.videomemory.autoplay=1),t("#utv-video-preview").attr("src",utvAdmin.generateEmbedUrl())}),t("#utv-videoadd-source").change(function(){var e=t(this).val();utvAdmin.videomemory.autoplay=0,e!=utvAdmin.videomemory.source&&(utvAdmin.videomemory.source=e,t("#utv-video-preview").attr("src",utvAdmin.generateEmbedUrl())),"youtube"==e?(t("#utv-videoadd-quality").parent("p").removeClass("utv-hide"),t("#utv-videoadd-chrome").parent("p").removeClass("utv-hide"),t("#utv-videoadd-endtime").parent("p").removeClass("utv-hide")):"vimeo"==e&&(t("#utv-videoadd-quality").parent("p").addClass("utv-hide"),t("#utv-videoadd-chrome").parent("p").addClass("utv-hide"),t("#utv-videoadd-endtime").parent("p").addClass("utv-hide"))}),t("#utv-album-thumb-select").on("click",".utv-album-thumb-choice",function(){var e=t(this);t("#utv-album-thumb-select .utv-album-thumb-choice").removeClass("utv-album-thumb-choice-active"),e.addClass("utv-album-thumb-choice-active");var i=e.find("img").attr("src"),a=i.replace(utvJSData.thumbCacheDirectory,"");a=a.replace(".jpg",""),t("#utv-album-selected-thumb").val(a),t("#utv-album-preview-thumb").attr("src",i)}),t("#utv-reset-overlay-color").click(function(){return t("#utv-overlay-color").val("#000"),!1}),t("#utv-reset-overlay-opacity").click(function(){return t("#utv-overlay-opacity").val("0.85"),!1}),t("#utv-reset-thumbnail-width").click(function(){return t("#utv-thumbnail-width").val("150"),!1}),t("#utv-reset-thumbnail-horizontal-padding").click(function(){return t("#utv-thumbnail-horizontal-padding").val("10"),!1}),t("#utv-reset-thumbnail-vertical-padding").click(function(){return t("#utv-thumbnail-vertical-padding").val("10"),!1}),t("#utv-reset-thumbnail-borderradius").click(function(){return t("#utv-thumbnail-borderradius").val("3"),!1}),t("#utv-reset-width").click(function(){return t("#utv-player-width").val("950"),t("#utv-player-height").val("537"),!1}),t("#utv-player-width").keyup(function(){t("#utv-player-height").val(Math.round(t("#utv-player-width").val()/1.77))}),t("#utv-player-height").keyup(function(){t("#utv-player-width").val(Math.round(1.77*t("#utv-player-height").val()))}),t(".ut-delete-gallery").click(function(){if(!confirm(utvJSData.translations.confirmGalleryDelete))return!1;var e=t(this).parents("tr"),i={action:"ut_deletegallery",key:e.attr("id"),nonce:utvJSData.nonces.deleteGallery};return t.post(ajaxurl,i,function(t){t&&e.fadeOut(400,function(){e.remove()})}),!1}),t(".utv-delete-playlist").click(function(){if(!confirm(utvJSData.translations.confirmPlaylistDelete))return!1;var e=t(this).parents("tr"),i={action:"utv_deleteplaylist",key:e.attr("id"),nonce:utvJSData.nonces.deletePlaylist};return t.post(ajaxurl,i,function(t){t&&e.fadeOut(400,function(){e.remove()})}),!1}),t("#utv-view-album .utv-sortable-table tbody").sortable({placeholder:"utv-sortable-placeholder",handle:".utv-sortable-handle",opacity:.8,containment:"parent",stop:function(e,i){var a={action:"utv_videoorderupdate",order:t("#utv-view-album .utv-sortable-table tbody").sortable("toArray").toString()};t.post(ajaxurl,a,function(t){})}}).disableSelection(),t(".ut-delete-video").click(function(){if(!confirm(utvJSData.translations.confirmVideoDelete))return!1;var e=t(this).parents("tr"),i=e.attr("id"),a=t("#utv-video-count"),l={action:"ut_deletevideo",key:i,nonce:utvJSData.nonces.deleteVideo};return t.post(ajaxurl,l,function(t){t&&(e.fadeOut(400,function(){e.remove()}),a.text(a.text()-1))}),!1}),t("#utv-view-album .utv-publish, #utv-view-album .utv-unpublish").click(function(){var e=t(this),i={action:"ut_publishvideo",key:e.parents("tr").attr("id"),changeTo:e.hasClass("utv-publish")?"0":"1",nonce:utvJSData.nonces.publishVideo};return utvAdmin.ajaxPubUnPubStatus(i,e),!1}),t("#utv-view-gallery .utv-sortable-table tbody").sortable({placeholder:"utv-sortable-placeholder",handle:".utv-sortable-handle",opacity:.8,containment:"parent",stop:function(e,i){var a={action:"utv_albumorderupdate",order:t("#utv-view-gallery .utv-sortable-table tbody").sortable("toArray").toString()};t.post(ajaxurl,a,function(t){})}}).disableSelection(),t(".ut-delete-album").click(function(){if(!confirm(utvJSData.translations.confirmAlbumDelete))return!1;var e=t(this).parents("tr"),i={action:"ut_deletealbum",key:e.attr("id"),nonce:utvJSData.nonces.deleteAlbum};return t.post(ajaxurl,i,function(t){t&&e.fadeOut(400,function(){e.remove()})}),!1}),t("#utv-view-gallery .utv-publish, #utv-view-gallery .utv-unpublish").click(function(){var e=t(this),i={action:"ut_publishalbum",key:e.parents("tr").attr("id"),changeTo:e.hasClass("utv-publish")?"0":"1",nonce:utvJSData.nonces.publishAlbum};return utvAdmin.ajaxPubUnPubStatus(i,e),!1}),t("#utv-playlistadd-source").change(function(){var e=t(this).val(),i=t("#utv-playlistadd-url").val(),a="";"youtube"==e?(t("#utv-playlistadd-quality").parent("p").removeClass("utv-hide"),t("#utv-playlistadd-chrome").parent("p").removeClass("utv-hide"),a="utv_fetchyoutubeplaylist"):"vimeo"==e&&(t("#utv-playlistadd-quality").parent("p").addClass("utv-hide"),t("#utv-playlistadd-chrome").parent("p").addClass("utv-hide"),a="utv_fetchvimeoplaylist"),""!=i&&e!=utvAdmin.playlistmemory.source&&(t("#utv-add-playlist").attr("disabled","disabled"),t("#utv-playlist-preview").html(""),t("#utv-playlist-preview-loader").removeClass("utv-hide"),utvAdmin.ajaxRetrievePlaylistData(i,a)),utvAdmin.playlistmemory.source=e}),t("#utv-playlistadd-url").change(function(){var e=t(this).val(),i=t("#utv-playlistadd-source").val();t("#utv-playlist-preview").html(""),t("#utv-playlist-preview-selectedcount, #utv-playlist-preview-totalcount").text("0"),t("#utv-add-playlist").removeAttr("disabled"),""!=e&&(t("#utv-add-playlist").attr("disabled","disabled"),t("#utv-playlist-preview-loader").removeClass("utv-hide"),"youtube"==i?utvAdmin.ajaxRetrievePlaylistData(e,"utv_fetchyoutubeplaylist"):utvAdmin.ajaxRetrievePlaylistData(e,"utv_fetchvimeoplaylist"))}),t("#utv-playlist-preview").on("click",".utv-playlist-choice",function(){var e=t(this),i=t("#utv-playlist-preview-selectedcount").text();e.hasClass("utv-playlist-choice-active")?(i--,e.removeClass("utv-playlist-choice-active")):(i++,e.addClass("utv-playlist-choice-active")),t("#utv-playlist-preview-selectedcount").text(i)}),t("#utv-add-playlist").click(function(){var e=t(this).parents("form"),i=[];if(t("#utv-playlist-preview").find(".utv-playlist-choice-active").each(function(){var e=t(this).next(".utv-playlist-preview-form").find(".utv-playlist-item-sourceid").val(),a=t(this).next(".utv-playlist-preview-form").find(".utv-playlist-item-title").val(),l=t(this).next(".utv-playlist-preview-form").find(".utv-playlist-item-apithumburl").val();i.push({sourceID:e,title:a,thumbURL:l})}),t("#utv-playlist-add-data").val(JSON.stringify(i)),utvAdmin.checkForm(e))return!1}),t("#utv-playlist-sync-save").click(function(){var e=[];t("#utv-playlist-preview").find(".utv-playlist-preview-item").each(function(){var i=t(this).find(".utv-playlist-item-id").val(),a=t(this).find(".utv-playlist-item-sourceid").val(),l=t(this).find(".utv-playlist-item-title").val(),u=t(this).find(".utv-playlist-item-apithumburl").val(),v=!!t(this).find(".utv-playlist-choice-active").length,n="";t(this).find(".utv-playlist-local").length?n="0":t(this).find(".utv-playlist-web").length?n="1":t(this).find(".utv-playlist-both").length&&(n="2"),e.push({localID:i,sourceID:a,title:l,thumbURL:u,selected:v,legend:n})}),t("#utv-playlist-sync-data").val(JSON.stringify(e))}),t("#utv-playlist-sync-selectall").click(function(){var e=t("#utv-playlist-preview-totalcount").text();t("#utv-playlist-preview-selectedcount").text(e),t("#utv-playlist-preview").find(".utv-playlist-choice").addClass("utv-playlist-choice-active")}),t("#utv-playlist-sync-selectnone").click(function(){t("#utv-playlist-preview-selectedcount").text("0"),t("#utv-playlist-preview").find(".utv-playlist-choice").removeClass("utv-playlist-choice-active")})})},utvAdmin.setupObjects=function(t){this.videomemory={source:"",vid:"",starttime:"",endtime:"",autoplay:"0"},this.playlistmemory={source:""}},utvAdmin.setupFunctions=function(t){this.checkTextField=function(t){if(""==t.val())return t.addClass("utv-invalid-field"),!0;t.removeClass("utv-invalid-field")},this.checkForm=function(e){var i=0;if(e.find('input[type="text"].utv-required').each(function(){utvAdmin.checkTextField(t(this))&&i++}),i>0)return!0},this.generateEmbedUrl=function(){return"youtube"==utvAdmin.videomemory.source?"https://www.youtube.com/embed/"+utvAdmin.videomemory.vid+"?modestbranding=1&rel=0&showinfo=0&autohide=0&iv_load_policy=3&color=white&theme=dark&rand="+utvAdmin.generateRandomInt()+"&autoplay="+utvAdmin.videomemory.autoplay+"&start="+utvAdmin.videomemory.starttime+"&end="+utvAdmin.videomemory.endtime:"vimeo"==utvAdmin.videomemory.source?"https://player.vimeo.com/video/"+utvAdmin.videomemory.vid+"?&title=0&portrait=0&byline=0badge=0&rand="+utvAdmin.generateRandomInt()+"&autoplay="+utvAdmin.videomemory.autoplay+"#t="+utvAdmin.videomemory.starttime:""},this.generateRandomInt=function(){return Math.floor(1e3*Math.random())},this.ajaxPubUnPubStatus=function(e,i){t.post(ajaxurl,e,function(t){t&&(i.hasClass("utv-publish")?(i.addClass("utv-unpublish"),i.removeClass("utv-publish")):(i.addClass("utv-publish"),i.removeClass("utv-unpublish")))})},this.ajaxRetrievePlaylistData=function(e,i){if(utvAdmin.notNull(e)&&utvAdmin.notNull(i)){var a={action:i,url:e,nonce:utvJSData.nonces.retrievePlaylist};t.post(ajaxurl,a,function(e){if(e&&e.valid&&e.data.videos.length>0){utvAdmin.playlistmemory.selectedvideos=e.data.videos.length;for(var i="",a=0;a<e.data.videos.length;a++)i+='<div class="utv-playlist-preview-item">                            <span class="utv-playlist-preview-item-num">'+(a+1)+')</span>                            <div class="utv-playlist-choice utv-playlist-choice-active">                                <img src="'+e.data.videos[a].thumbURL+'"/>                                <span class="utv-playlist-choice-overlay"></span>                            </div>                            <div class="utv-playlist-preview-form">                                <input type="text" class="utv-playlist-item-title" value="'+e.data.videos[a].title+'"/>                                <span class="utv-playlist-item-duration">'+e.data.videos[a].duration+'</span>                                <input type="hidden" class="utv-playlist-item-sourceid" value="'+e.data.videos[a].videoId+'"/>                                <input type="hidden" class="utv-playlist-item-apithumburl" value="'+e.data.videos[a].thumbURL+'"/>                            </div>                        </div>';t("#utv-playlist-preview-loader").addClass("utv-hide"),t("#utv-playlist-preview").html(i),t("#utv-playlist-preview-selectedcount, #utv-playlist-preview-totalcount").text(e.data.videos.length),t("#utv-playlist-add-title").val(e.data.title),utvAdmin.setErrorMessage(t("#utv-add-playlist-message"),""),t("#utv-add-playlist").removeAttr("disabled")}else t("#utv-playlist-preview-loader").addClass("utv-hide"),t("#utv-playlist-preview-selectedcount, #utv-playlist-preview-totalcount").text("0"),t("#utv-playlist-add-title").val(""),utvAdmin.setErrorMessage(t("#utv-add-playlist-message"),e.message)})}},this.notNull=function(t){return void 0!=t&&""!=t},this.setErrorMessage=function(t,e){utvAdmin.notNull(t)&&t.text(e)}},function(t){utvAdmin.initialize(t)}(jQuery);
